<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Materi Tersimpan - ExtraCourse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB; /* bg-slate-50 */
        }
        /* ... (Salin semua style CSS dari halaman sebelumnya untuk konsistensi) ... */
        .preview-card { position: relative; transition: all 0.3s ease; }
        .nav-link { position: relative; transition: color 0.3s ease; }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; transform: translateX(-50%); background-color: #2563EB; transition: width 0.3s ease; }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .nav-link:hover, .nav-link.active { color: #2563EB; }
        .logo-image { height: 70px; width: auto; }
        .breadcrumb a:hover { text-decoration: underline; }
        .save-materi-btn { /* Style untuk tombol simpan di kartu */ }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header (Struktur sama seperti halaman lain) -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <!-- ... Konten Header Lengkap ... -->
    </header>

    <!-- Main Content: Materi Tersimpan -->
    <main class="container mx-auto px-6 py-12 md:py-16">
        <div class="mb-8">
            <nav class="text-sm breadcrumb" aria-label="Breadcrumb">
              <ol class="list-none p-0 inline-flex">
                <li class="flex items-center">
                  <a href="index.html#home" class="text-blue-600 hover:text-blue-800">Home</a>
                  <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                </li>
                 <li class="flex items-center">
                  <a href="profil.html" class="text-blue-600 hover:text-blue-800">Profil Saya</a>
                  <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
                </li>
                <li>
                  <span class="text-slate-500" aria-current="page">Materi Tersimpan</span>
                </li>
              </ol>
            </nav>
        </div>

        <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-8">Materi Tersimpan Anda</h1>

        <!-- Container untuk kartu-kartu materi -->
        <div id="savedMateriContainer" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Kartu materi akan di-render di sini oleh JavaScript -->
        </div>

        <!-- Pesan Loading -->
        <div id="loadingState" class="text-center py-20">
            <p class="text-slate-500">Memuat materi tersimpan...</p>
        </div>

        <!-- Pesan jika tidak ada materi yang disimpan -->
        <div id="emptyState" class="hidden text-center py-20 bg-white rounded-lg shadow">
            <h2 class="text-2xl font-semibold text-slate-700">Anda Belum Menyimpan Materi</h2>
            <p class="text-slate-500 mt-2 mb-6">Mulai jelajahi dan simpan materi yang Anda sukai!</p>
            <a href="semua-materi.html" class="auth-button auth-button-primary">Jelajahi Semua Materi</a>
        </div>
    </main>

    <script type="module">
        // --- Firebase Config & Initialization ---
        const firebaseConfig = { /* ...KONFIGURASI FIREBASE ANDA... */ };
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Simulasi Database Materi ---
        const allMaterialsData = {
            'grammar-essentials': { title: 'English Grammar Essentials', desc: 'Pahami tenses, parts of speech...', img: 'https://placehold.co/600x400/3B82F6/FFFFFF?text=English+Grammar', level: 'PEMULA', levelColor: 'blue' },
            'daily-vocab': { title: 'Daily Conversation Vocabulary', desc: 'Perkaya kosakata untuk percakapan...', img: 'https://placehold.co/600x400/10B981/FFFFFF?text=Daily+Vocabulary', level: 'MENENGAH', levelColor: 'green' },
            'listening-comprehension': { title: 'Listening Comprehension', desc: 'Latih kemampuan mendengar...', img: 'https://placehold.co/600x400/F59E0B/FFFFFF?text=Listening+Practice', level: 'SEMUA LEVEL', levelColor: 'yellow' },
            'toefl-prep': { title: 'TOEFL/IELTS Preparation', desc: 'Strategi dan latihan soal...', img: 'https://placehold.co/600x400/6366F1/FFFFFF?text=TOEFL+Preparation', level: 'MAHIR', levelColor: 'indigo' },
            'business-english': { title: 'Business English Communication', desc: 'Tingkatkan kemampuan untuk bisnis...', img: 'https://placehold.co/600x400/EC4899/FFFFFF?text=Business+English', level: 'MENENGAH', levelColor: 'pink' },
            'pronunciation': { title: 'Perfect Your Pronunciation', desc: 'Pelajari cara melafalkan kata...', img: 'https://placehold.co/600x400/8B5CF6/FFFFFF?text=Pronunciation', level: 'SEMUA LEVEL', levelColor: 'purple' },
            'writing-skills': { title: 'Academic Writing Skills', desc: 'Kembangkan kemampuan menulis...', img: 'https://placehold.co/600x400/F0B90B/FFFFFF?text=Writing+Skills', level: 'MAHIR', levelColor: 'amber' },
            'kids-english': { title: 'Fun English for Kids', desc: 'Pembelajaran menyenangkan untuk anak...', img: 'https://placehold.co/600x400/14B8A6/FFFFFF?text=Kids+English', level: 'PEMULA', levelColor: 'teal' }
        };
        const levelColorClasses = {
            'blue': 'bg-blue-100 text-blue-700', 'green': 'bg-green-100 text-green-700', 'yellow': 'bg-yellow-100 text-yellow-700', 'indigo': 'bg-indigo-100 text-indigo-700',
            'pink': 'bg-pink-100 text-pink-700', 'purple': 'bg-purple-100 text-purple-700', 'amber': 'bg-amber-100 text-amber-700', 'teal': 'bg-teal-100 text-teal-700'
        };
        
        // --- Logika Header (harus disalin dari index.html) ---
        // ... ...

        // --- Logika Halaman Ini ---
        const loadingStateDiv = document.getElementById('loadingState');
        const emptyStateDiv = document.getElementById('emptyState');
        const savedMateriContainer = document.getElementById('savedMateriContainer');

        function renderSavedMaterials(savedIds) {
            savedMateriContainer.innerHTML = ''; // Kosongkan container dulu

            if (!savedIds || savedIds.length === 0) {
                emptyStateDiv.classList.remove('hidden');
                return;
            }

            emptyStateDiv.classList.add('hidden');

            savedIds.forEach(materiId => {
                const materiData = allMaterialsData[materiId];
                if (materiData) {
                    const levelClass = levelColorClasses[materiData.levelColor] || 'bg-gray-100 text-gray-700';
                    const cardHTML = `
                        <div class="preview-card bg-white p-6 rounded-xl shadow-lg border border-gray-200 flex flex-col" data-materi-id="${materiId}">
                            <!-- Tombol simpan bisa ditambahkan di sini jika ingin ada fungsi "un-save" dari halaman ini -->
                            <img src="${materiData.img}" alt="Materi ${materiData.title}" class="rounded-md mb-4 h-40 w-full object-cover">
                            <h4 class="text-lg font-semibold text-blue-700 mb-2">${materiData.title}</h4>
                            <p class="text-sm text-slate-600 mb-3 flex-grow">${materiData.desc}</p>
                            <div class="mt-auto flex justify-between items-center">
                                <span class="text-xs ${levelClass} px-2 py-1 rounded-full">${materiData.level}</span>
                                <a href="#" class="text-sm font-medium text-blue-600 hover:text-blue-800">Lihat Detail &rarr;</a>
                            </div>
                        </div>
                    `;
                    savedMateriContainer.innerHTML += cardHTML;
                }
            });
        }

        onAuthStateChanged(auth, async (user) => {
            // updateHeaderUI(user); // Panggil fungsi update header

            if (user) {
                const uid = user.uid;
                const userDocRef = doc(db, "userSavedMaterials", uid);
                
                try {
                    const docSnap = await getDoc(userDocRef);
                    let savedIds = [];
                    if (docSnap.exists() && docSnap.data().savedMaterialIds) {
                        savedIds = docSnap.data().savedMaterialIds;
                        console.log("Materi tersimpan ditemukan:", savedIds);
                    } else {
                        console.log("Tidak ada materi yang disimpan.");
                    }
                    renderSavedMaterials(savedIds);
                } catch (error) {
                    console.error("Gagal mengambil data:", error);
                    renderSavedMaterials([]); // Tampilkan status kosong jika ada error
                } finally {
                    loadingStateDiv.style.display = 'none';
                }
            } else {
                // Redirect jika tidak login
                window.location.href = `login-page.html?redirect=${window.location.pathname}`;
            }
        });
    </script>
</body>
</html>
